#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date true
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title

\series bold
Unit 2.
 Task 3: SSL module activation and creation of a secure Apache server
\end_layout

\begin_layout Author
Javier Aguilera Aguilera 2ยบ CFGS DAW
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Installing openssl
\end_layout

\begin_layout Standard
In this task we are going to activate de SSL module in order to create a
 secure Apache server.
\end_layout

\begin_layout Standard
First of all, we will make sure whether SSL module is already installed
 in our system or not.
 Typing at the terminal 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo apt install openssl
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im1.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
In my case, it is already installed
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Setting up the server key
\end_layout

\begin_layout Standard
Then, we are going to to set up the server key by the command
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo openssl genrsa -des -out server_key_name
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Where server_key_name is the name of your server key.
 In my case, I will call it Ubuntu.key.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im2.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
It ask for a passphrase
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
From now on, every time that the server_key_name is required I will write
 Ubuntu.key.
\end_layout

\begin_layout Subsection
Writing server key
\end_layout

\begin_layout Standard
The following instruction to execute is 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo openssl rsa -in Ubuntu.key -out Ubuntu.key
\end_layout

\end_inset


\end_layout

\begin_layout Standard
It replace the old server key with the new one we just defined.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im3.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
It ask for the previos pass phrase
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Naming our server
\end_layout

\begin_layout Standard
Then, we have to write in the command line 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo openssl req -new -key Ubuntu.key 
\end_layout

\begin_layout Plain Layout

-out server_name
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Where server_name is the name of your server.
 In my case, I will call it Secury.csr.
\end_layout

\begin_layout Standard
From now on, every time that the server_name is required I will write Secury.csr.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im4.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
We need to fill some fields of required information
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Setting up the certificate duration
\end_layout

\begin_layout Standard
Execute the command:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo openssl x509 -req -days 365 -in 
\end_layout

\begin_layout Plain Layout

Secury.csr -signkey Ubuntu.key -out Secury.crt
\end_layout

\end_inset


\end_layout

\begin_layout Standard
365 is the duration equivalent a complete year.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im5.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Setting up the certificate duration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Making ssl directory
\end_layout

\begin_layout Standard
We are going to create a directory in order to store the server information
 set before.
 We have to write in the terminal 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo mkdir /etc/apache2/ssl
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Then, execute 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo mv Ubuntu.key Secury.crt /etc/apache2/ssl
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im6.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Command summary
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Enable SSL module
\end_layout

\begin_layout Standard
If we have right done all previous steps, it is time to enable the SSL module
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo a2enmod ssl
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im7.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
SSL enabled
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, it is compulsory to modify 
\emph on
/etc/apache2/sites-available/default-ssl.conf 
\emph default
.
 Once you have opened it, you have to search the lines which contains 
\begin_inset Quotes eld
\end_inset

SSLCertificateFile
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

SSLCertificateKeyFile
\begin_inset Quotes erd
\end_inset

 and you have to replace them with the followings: 
\end_layout

\begin_layout Itemize
SSLCertificateFile /etc/apache2/ssl/Secury.crt
\end_layout

\begin_layout Itemize
SSLCertificateKeyFile /etc/apache2/ssl/Ubuntu.key
\end_layout

\begin_layout Standard
A valid option is to comment those lines with an 
\begin_inset Quotes eld
\end_inset

#
\begin_inset Quotes erd
\end_inset

 which allow to restore the original parameters
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo gedit /etc/apache2/sites-available/default-ssl.conf 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im9.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
default-ssl.conf before modifications
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im10.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
default-ssl.conf after modifications
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Testing if port 443 is opened
\end_layout

\begin_layout Standard
In order to verify if port 443 is opened, we have to open with a text editor
 the 
\emph on
ports.conf
\emph default
 file (
\emph on
/etc/apache2/ports.conf
\emph default
), in my case with Gedit:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo gedit /etc/apache2/ports.conf
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im8.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
As we can see, Listen 403 is uncommented, so it will works
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Reboot default-ssl and apache2
\end_layout

\begin_layout Standard
Using the commands
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo a2ensite default-ssl
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

$ sudo systemctl reload apache2
\end_layout

\end_inset


\end_layout

\begin_layout Section
Testing
\end_layout

\begin_layout Standard
Last step is to check if we have made our configuration correctly.
 Open your favorite browser and search for 
\begin_inset Quotes eld
\end_inset

https://localhost
\begin_inset Quotes erd
\end_inset

 and a similar page to this is going to appear:
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im11.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
It says that it is not secure, let's see in 
\emph on
View Certificate
\emph default
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im12.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Our certificate information
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
To access localhost, we have to 
\begin_inset Quotes eld
\end_inset

Accept the Risk and Continue
\begin_inset Quotes erd
\end_inset

.
 It is a security measure enabled by default because our certificate has
 not been validated by an official organism.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename im13.png
	lyxscale 60
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
It works!
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_body
\end_document
